---
title: 网站主题切换功能实现
date: 2022-04-24 16:49:43
tags:
  - 主题切换
  - vue
categories:
  - 前端
---

网站的主题切换可以分为颜色的切换和图片的切换，本文使用 `vue3 + vite` 进行实现。

<!-- more -->

## 方案

主题的保存主要分为三块儿。

首先使用 `localStorage` 对用户选择的主题进行缓存，方便用户再次进入网站读取上次保存的主题。

`body` 节点中设置 `data-theme` 自定义属性保存当前主题，为颜色的切换提供保障。

状态管理中定义当前主题，方便每个组件动态加载当前主题的图片。

## 主题切换

状态管理中定义保存主题的变量，以及设置它的方法。

```js
import { defineStore } from 'pinia'
export const useAppStore = defineStore({
  id: 'app',
  state: () => {
    return {
      theme: "white",
    }
  },
  actions: {
    /**
     * 设置主题
     * @param {String} theme 
     */
    setTheme(theme) {
      this.theme = theme
      window.localStorage.setItem("theme", theme)
      document.querySelector("body").setAttribute("data-theme", theme)
    }
  }
})
```

网站初始化时读取缓存，若保存了主题则设置网站主题为保存的主题，否则设置默认主题。

```js
onMounted(()=>{
  const theme = localStorage.getItem("theme")
  if(theme){
    appStore.setTheme(theme)
  }else{
    appStore.setTheme("white")
  }
})
```

用户进行主题切换。

```js
import { useAppStore } from '@/stores/app'
const appStore = useAppStore()
...
appStore.setTheme('white')
```

## 颜色切换

主题保存至 `body` 节点的 `data-theme` 属性中，在 `styles/theme.css` 文件中定义不同主题的颜色变量。

```css
/* 白色主题变量 */
[data-theme=white]{
  --bg: #fff;
  --color: #333
}

/* 黑色主题变量 */
[data-theme=black]{
  --bg: #333;
  --color: #fff
}
```

在组件中使用变量。

```css
...
background-color: var(--bg);
...
color: var(--color);
...
```

## 图片切换

不同主题的图片存放在不同的主题文件夹下，相对路径保持一致。

动态引入图片。

```js
import { useAppStore } from '@/stores/app'
const appStore = useAppStore()
...
const logo = computed(() => {
  return `/theme/${appStore.theme}/logo.png`
})
```

## 项目地址

[https://gitee.com/Rexiamu/switch-theme-demo](https://gitee.com/Rexiamu/switch-theme-demo)
